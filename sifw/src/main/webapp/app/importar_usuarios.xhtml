<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="jakarta.faces.html"
	xmlns:f="jakarta.faces.core"
	xmlns:ui="jakarta.faces.facelets"
	xmlns:p="http://primefaces.org/ui" template="/public/_template.xhtml">


	<ui:define name="header">
		<ui:include src="/app/header.xhtml" />
	</ui:define>

	<ui:define name="nav">
		<ui:include src="/app/nav.xhtml" />
	</ui:define>

	<ui:define name="main">

		<h:form id="frmMain" enctype="multipart/form-data">
			<p:growl showDetail="true" showSummary="true">
				<p:autoUpdate></p:autoUpdate>
			</p:growl>
			
			<p:breadCrumb model="#{importarUsuariosBean.breadCrumb.model}"  id="breadcrumb">
				<p:autoUpdate />
			</p:breadCrumb>	

			<p:outputPanel>
				<p:panel header="Busca de usuários" rendered="#{importarUsuariosBean.rendSeleciona}">
					<div class="ui-fluid formgrid grid">
						<div class="field col-6 md:col-6">
							<label>Importar usuários:</label>
						</div>
						<div class="field col-6 md:col-6">
							<p:selectOneMenu value="#{importarUsuariosBean.tipoimportacao}" converter="omnifaces.SelectItemsConverter">
								<f:selectItems value="#{importarUsuariosBean.listSelectIten}" var ="l" />
								<p:ajax event="change" listener="#{importarUsuariosBean.eventChange}"  update="frmMain otpEnviaCSV"/>
							</p:selectOneMenu>
						</div>
					</div>
				</p:panel>
			</p:outputPanel>

			<p:outputPanel rendered="#{importarUsuariosBean.rendConfigTypeCSV}">

				<p:commandButton action="#{importarUsuariosBean.telaConfigTipoImportacao}" label="ds"></p:commandButton>

				<p:dataTable >
					<f:facet name="header">
						<div class="flex justify-content-between flex-wrap">
							<div>Arquivos enviados</div>
							<div>
								<p:commandButton type="button" value="Add" icon="pi pi-plus"  onclick="PF('dlgFile').show()"></p:commandButton>
							</div>
						</div>
					</f:facet>
				</p:dataTable>
			</p:outputPanel>

			<p:dialog header="Header" widgetVar="dlgFile"  showEffect="fade" modal="true" closeOnEscape="true">
				<p:outputPanel >
					<p:panel header="Importando Usuarios a partir de um CSV">
						<div class="ui-fluid formgrid grid">
							<div class="field col-12 md:col-12">
								<p:fileUpload auto="true" skinSimple="true" mode="simple" listener="#{importarUsuariosBean.upload}" label="Arquivo" displayFilename="true">
									<p:validateFile allowTypes="/(\.|\/)(csv)$/" />
								</p:fileUpload>

							</div>
							<div class="field col-12 md:col-12">
								<label>Curso:</label>

							</div>
							<div class="field col-12 md:col-3">
								<h:outputLabel value="Possui Roles:" />
								<p:selectBooleanCheckbox value="#{importarUsuariosBean.possuiRole}">
									<p:ajax update="selectColunaRole"></p:ajax>
								</p:selectBooleanCheckbox>
							</div>
							<div class="field col-12 md:col-3">
								<h:outputLabel value="Coluna das Roles:(0->X)"/>
								<p:inputNumber id="selectColunaRole" value="#{importarUsuariosBean.colunaRole}" disabled="#{!importarUsuariosBean.possuiRole}"/>
							</div>

							<div class="field col-12 md:col-3">
								<h:outputLabel value="Linha do primeiro registro:(0 -> X)" />
								<p:inputNumber value="#{importarUsuariosBean.firstRecrd}"/>
							</div>
							<div class="field col-12 md:col-3">
								<h:outputLabel value="Inativar usuários ausentes:"/>
								<p:selectBooleanCheckbox value="#{importarUsuariosBean.inativarMatriculasAusentes}"/>
							</div>

							<div class="field col-12 md:col-5">
								<h:outputLabel value="Nome do Arquivo:" for="optFileName"/>
								<h:outputText value="#{importarUsuariosBean.file.fileName}" id="optFileName"/>
							</div>

							<div class="field col-12 md:col-3">
								<h:outputLabel value="Total de registros:" for="optTotalRecord"/>
								<h:outputText value="#{importarUsuariosBean.sizeListRecord}" id="optTotalRecord"/>
							</div>
						</div>
						<p:commandButton actionListener="#{importarUsuariosBean.initCreateUsers()}" value="Iniciar" ></p:commandButton>

						<p>(0 -> X) primeira linha ou coluna do csv começa em 0, mas os dados começão em X</p>
						<p:fragment  rendered="false">
							<p:outputPanel id="itaSaida">
								<h:outputText value="#{importarUsuariosBean.saidaTextoImportUser}" escape="false" style="    font-family: 'Courier New', monospace !important;"/>
							</p:outputPanel>
							<p:poll interval="2" update="frmMain:itaSaida" />
						</p:fragment>

					</p:panel>
				</p:outputPanel>
			</p:dialog>
		</h:form>

	</ui:define>
</ui:composition>
